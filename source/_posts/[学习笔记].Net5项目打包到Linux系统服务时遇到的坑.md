---
thumbnail:
cover:
title: '[学习笔记].Net5项目打包到Linux系统服务时遇到的坑'
excerpt:
description:
date: 2022-02-15 09:41:00
tags:
  - Linux
  - .net

categories:
  - .NET
 
toc: true
recommend: 1
keywords: categories-java
uniqueId: 2022-02-15 09:41:00/[学习笔记].Net5项目打包到Linux系统服务时遇到的坑.html
---
<p><span data-cke-copybin-start="1"><span data-cke-copybin-start="1">​</span></span><span id="cke_bm_333S">如果按照官方文档的步骤手动安装.Net5 会有一个坑：</span></p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_csdnlink cke_widget_wrapper_has-card cke_widget_selected" data-cke-display-name="a" data-cke-filter="off" data-cke-widget-id="7" data-cke-widget-wrapper="1"><a class="has-card cke_widget_editable cke_widget_element" title="在 Linux 上手动安装 .NET - .NET | Microsoft Docs" href="https://docs.microsoft.com/zh-cn/dotnet/core/install/linux-scripted-manual" data-cke-enter-mode="2" data-cke-saved-href="https://docs.microsoft.com/zh-cn/dotnet/core/install/linux-scripted-manual" data-cke-widget-data="%7B%22url%22%3A%22https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Fcore%2Finstall%2Flinux-scripted-manual%22%2C%22text%22%3A%22%E5%9C%A8%20Linux%20%E4%B8%8A%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%20.NET%20-%20.NET%20%7C%20Microsoft%20Docs%22%2C%22desc%22%3A%22%22%2C%22icon%22%3A%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fblog_editor_html%2Frelease1.9.8%2Fckeditor%2Fplugins%2FCsdnLink%2Ficons%2Ficon-default.png%3Ft%3DM0H8%22%2C%22isCard%22%3Atrue%2C%22hasResquest%22%3Atrue%2C%22iconDefault%22%3A%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fblog_editor_html%2Frelease1.9.8%2Fckeditor%2Fplugins%2FCsdnLink%2Ficons%2Ficon-default.png%3Ft%3DM0H8%22%2C%22id%22%3A%22jT1QXy-1644889132946%22%2C%22classes%22%3A%7B%22has-card%22%3A1%7D%7D" data-cke-widget-editable="text" data-cke-widget-keep-attr="0" data-cke-widget-upcasted="1" data-link-icon="https://csdnimg.cn/release/blog_editor_html/release1.9.8/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=M0H8" data-link-title="在 Linux 上手动安装 .NET - .NET | Microsoft Docs" data-widget="csdnlink"><span class="link-card-box"><span class="link-title">在 Linux 上手动安装 .NET - .NET | Microsoft Docs</span></span></a></span></p>
<p>在使用systemd打包.Net5服务的时候，无法运行，报错如下图：</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-display-name="图像" data-cke-filter="off" data-cke-widget-id="6" data-cke-widget-wrapper="1"><img src="https://img-blog.csdnimg.cn/0a31853e2aec4a1e8bf4352c87302c2e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5p6X5pmTbHg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="" width="1168" height="121" class="cke_widget_element" data-cke-saved-src="https://img-blog.csdnimg.cn/0a31853e2aec4a1e8bf4352c87302c2e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5p6X5pmTbHg=,size_20,color_FFFFFF,t_70,g_se,x_16" data-cke-widget-data="%7B%22hasCaption%22%3Afalse%2C%22src%22%3A%22https%3A%2F%2Fimg-blog.csdnimg.cn%2F0a31853e2aec4a1e8bf4352c87302c2e.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_d3F5LXplbmhlaQ%2Cshadow_50%2Ctext_Q1NETiBA5p6X5pmTbHg%3D%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16%22%2C%22alt%22%3A%22%22%2C%22width%22%3A%221168%22%2C%22height%22%3A%22121%22%2C%22lock%22%3Atrue%2C%22align%22%3A%22none%22%2C%22classes%22%3Anull%7D" data-cke-widget-keep-attr="0" data-cke-widget-upcasted="1" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container"><img src="https://img2022.cnblogs.com/blog/644861/202202/644861-20220215094054877-2089957752.gif" width="15" height="15" class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" data-cke-widget-drag-handler="1" /><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>查询系统日志发现对dotnet访问没有权限，dotnet已设置权限755并且service的配置文件中User已配置为本人用户&nbsp;</p>
<p>奇怪的是作为本人用户登录在终端中使用dotnet是有权限的。</p>
<p>好一番寻找发现，systemd会阻止位于用户的主目录(Home)中二进制文件的运行。</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_csdnlink cke_widget_wrapper_has-card cke_widget_selected" data-cke-display-name="a" data-cke-filter="off" data-cke-widget-id="5" data-cke-widget-wrapper="1"><a class="has-card cke_widget_editable cke_widget_element" title="linux - Failed at step EXEC spawning... Permission denied - Server Fault" href="https://serverfault.com/questions/957084/failed-at-step-exec-spawning-permission-denied" data-cke-enter-mode="2" data-cke-saved-href="https://serverfault.com/questions/957084/failed-at-step-exec-spawning-permission-denied" data-cke-widget-data="%7B%22url%22%3A%22https%3A%2F%2Fserverfault.com%2Fquestions%2F957084%2Ffailed-at-step-exec-spawning-permission-denied%22%2C%22text%22%3A%22linux%20-%20Failed%20at%20step%20EXEC%20spawning...%20Permission%20denied%20-%20Server%20Fault%22%2C%22desc%22%3A%22%22%2C%22icon%22%3A%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fblog_editor_html%2Frelease1.9.8%2Fckeditor%2Fplugins%2FCsdnLink%2Ficons%2Ficon-default.png%3Ft%3DM0H8%22%2C%22isCard%22%3Atrue%2C%22hasResquest%22%3Atrue%2C%22iconDefault%22%3A%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fblog_editor_html%2Frelease1.9.8%2Fckeditor%2Fplugins%2FCsdnLink%2Ficons%2Ficon-default.png%3Ft%3DM0H8%22%2C%22id%22%3A%22MJcFUL-1644889132938%22%2C%22classes%22%3A%7B%22has-card%22%3A1%7D%7D" data-cke-widget-editable="text" data-cke-widget-keep-attr="0" data-cke-widget-upcasted="1" data-link-icon="https://csdnimg.cn/release/blog_editor_html/release1.9.8/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=M0H8" data-link-title="linux - Failed at step EXEC spawning... Permission denied - Server Fault" data-widget="csdnlink"><span class="link-card-box"><span class="link-title">linux - Failed at step EXEC spawning... Permission denied - Server Fault</span></span></a></span></p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_csdnlink cke_widget_wrapper_has-card cke_widget_selected" data-cke-display-name="a" data-cke-filter="off" data-cke-widget-id="5" data-cke-widget-wrapper="1">我一下就想起来安装dotnet的时候完全闭眼copy的微软文档的命令。打开微软文档一看，果不其然，安装目录是{home_path}/dotnet！！</span></p>
<p><span id="cke_bm_334S">&nbsp;因此重新安装，首先下载源代码至/usr/local/src/</span></p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_selected" data-cke-display-name="代码段" data-cke-filter="off" data-cke-widget-id="4" data-cke-widget-wrapper="1">
<pre class="cke_widget_element" data-cke-widget-data="%7B%22code%22%3A%22%20sudo%20wget%20-P%20%2Fusr%2Flocal%2Fsrc%2F%20%20https%3A%2F%2Fdownload.visualstudio.microsoft.com%2Fdownload%2Fpr%2Fe10f8ecd-eb2c-42a0-a217-98a18517e12c%2F436b90a4d5be20456b210c406c0f7718%2Fdotnet-sdk-5.0.405-linux-x64.tar.gz%22%2C%22classes%22%3Anull%7D" data-cke-widget-keep-attr="0" data-cke-widget-upcasted="1" data-widget="codeSnippet"><code class="hljs"> sudo wget -P /usr/local/src/  https://download.visualstudio.microsoft.com/download/pr/e10f8ecd-eb2c-42a0-a217-98a18517e12c/436b90a4d5be20456b210c406c0f7718/dotnet-sdk-5.0.405-linux-x64.tar.gz</code></pre>
<span class="cke_reset cke_widget_drag_handler_container"><img src="https://img2022.cnblogs.com/blog/644861/202202/644861-20220215094054877-2089957752.gif" width="15" height="15" class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" data-cke-widget-drag-handler="1" /></span></div>
<p>创建名为dotnet主目录并将二进制文件解压至该目录</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_selected" data-cke-display-name="代码段" data-cke-filter="off" data-cke-widget-id="3" data-cke-widget-wrapper="1">
<pre class="cke_widget_element" data-cke-widget-data="%7B%22code%22%3A%22sudo%20mkdir%20..%2Fdotnet%5Cnsudo%20tar%20zxvf%20dotnet-sdk-5.0.404-linux-x64.tar.gz%20-C%20..%2Fdotnet%22%2C%22classes%22%3Anull%7D" data-cke-widget-keep-attr="0" data-cke-widget-upcasted="1" data-widget="codeSnippet"><code class="hljs">sudo mkdir ../dotnet
sudo tar zxvf dotnet-sdk-5.0.404-linux-x64.tar.gz -C ../dotnet</code></pre>
<span class="cke_reset cke_widget_drag_handler_container"><img src="https://img2022.cnblogs.com/blog/644861/202202/644861-20220215094054877-2089957752.gif" width="15" height="15" class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" data-cke-widget-drag-handler="1" /></span></div>
<p>打开~/.bashrc文件，末尾添加如下两行配置DOTNET_ROOT环境变量</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_selected" data-cke-display-name="代码段" data-cke-filter="off" data-cke-widget-id="2" data-cke-widget-wrapper="1">
<pre class="cke_widget_element" data-cke-widget-data="%7B%22code%22%3A%22export%20DOTNET_ROOT%3D%2Fusr%2Flocal%2Fdotnet%2F%5Cnexport%20PATH%3D%24PATH%3A%24DOTNET_ROOT%22%2C%22classes%22%3Anull%7D" data-cke-widget-keep-attr="0" data-cke-widget-upcasted="1" data-widget="codeSnippet"><code class="hljs">export DOTNET_ROOT=/usr/local/dotnet/
export PATH=$PATH:$DOTNET_ROOT</code></pre>
<span class="cke_reset cke_widget_drag_handler_container"><img src="https://img2022.cnblogs.com/blog/644861/202202/644861-20220215094054877-2089957752.gif" width="15" height="15" class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" data-cke-widget-drag-handler="1" /></span></div>
<p>保存并运行</p>
<div class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_selected" data-cke-display-name="代码段" data-cke-filter="off" data-cke-widget-id="1" data-cke-widget-wrapper="1">
<pre class="cke_widget_element" data-cke-widget-data="%7B%22code%22%3A%22source%20.bashr%22%2C%22classes%22%3Anull%7D" data-cke-widget-keep-attr="0" data-cke-widget-upcasted="1" data-widget="codeSnippet"><code class="hljs">source .bashr</code></pre>
<span class="cke_reset cke_widget_drag_handler_container"><img src="https://img2022.cnblogs.com/blog/644861/202202/644861-20220215094054877-2089957752.gif" width="15" height="15" class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" data-cke-widget-drag-handler="1" /></span></div>
<p>用whereis命令查看dotnet已经在规范的目录中了<br />
<span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-display-name="图像" data-cke-filter="off" data-cke-widget-id="0" data-cke-widget-wrapper="1"><img src="https://img-blog.csdnimg.cn/33e30a78f1c74d9aaf9ac1fd9c98dea3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5p6X5pmTbHg=,size_16,color_FFFFFF,t_70,g_se,x_16" alt="" width="413" height="50" class="cke_widget_element" data-cke-saved-src="https://img-blog.csdnimg.cn/33e30a78f1c74d9aaf9ac1fd9c98dea3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5p6X5pmTbHg=,size_16,color_FFFFFF,t_70,g_se,x_16" data-cke-widget-data="%7B%22hasCaption%22%3Afalse%2C%22src%22%3A%22https%3A%2F%2Fimg-blog.csdnimg.cn%2F33e30a78f1c74d9aaf9ac1fd9c98dea3.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_d3F5LXplbmhlaQ%2Cshadow_50%2Ctext_Q1NETiBA5p6X5pmTbHg%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16%22%2C%22alt%22%3A%22%22%2C%22width%22%3A%22413%22%2C%22height%22%3A%2250%22%2C%22lock%22%3Atrue%2C%22align%22%3A%22none%22%2C%22classes%22%3Anull%7D" data-cke-widget-keep-attr="0" data-cke-widget-upcasted="1" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container"><img src="https://img2022.cnblogs.com/blog/644861/202202/644861-20220215094054877-2089957752.gif" width="15" height="15" class="cke_reset cke_widget_drag_handler" title="点击并拖拽以移动" data-cke-widget-drag-handler="1" /><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>
<span data-cke-copybin-start="1">
<span data-cke-copybin-end="1">​</span></span></p>